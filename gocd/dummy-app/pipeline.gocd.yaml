format_version: 4

pipelines:
  git-writer-test:
    group: dummy-app
    label_template: ${git[:7]}

    materials:
      git:
        git: https://github.com/manav11vanam/sample-pipelines.git
        branch: main
        shallow_clone: true
        auto_update: true

    stages:
    - bump-version:
        clean_workspace: true
        jobs:
          edit-file:
            elastic_profile_id: demo-app
            tasks:
            - exec:
                command: /bin/sh
                arguments:
                - -c
                - |
                  set -e

                  echo "Before:"
                  cat argocd/dummy-app/version.txt

                  echo "version=$(date +%s)" > argocd/dummy-app/version.txt

                  git config user.email "gocd@local"
                  git config user.name "GoCD"

                  git add argocd/dummy-app/version.txt
                  git commit -m "chore: bump dummy app version"
                  git push https://$GIT_USERNAME:$GIT_PASSWORD@github.com/manav11vanam/sample-pipelines.git HEAD:main
